FROM ubuntu
MAINTAINER Sam Irvine

USER root
RUN apt-get update -y && apt-get install -y wget default-jre default-jdk

WORKDIR /opt/
RUN wget https://www15.software.ibm.com/sdfdl/v2/fulfill/CNEM5EN/Xa.2/Xb.aFmQQe8PD7-qs_TfXneOo96GJPenzgHWZG5yci-HJio/Xc.CNEM5EN/URBANCODE_DEPLOY_6.2.2_EN_EVAL.zip/Xd./Xf.LPR.F1AZ/Xg.8840937/Xi.RATLe-UCDeploy-EVAL/XY.regsrvs/XZ.6VnFW9_sc9CBYP6otRmChl0D5WU/URBANCODE_DEPLOY_6.2.2_EN_EVAL.zip
#RUN tar xvzf latest-unix.tar.gz


RUN echo "mysql-server mysql-server/root_password password root" | debconf-set-selections
RUN echo "mysql-server mysql-server/root_password_again password root" | debconf-set-selections
RUN apt-get install -y mysql-server libmysql-java

RUN service mysql start && echo "CREATE DATABASE UCD character set utf8 collate utf8_bin;CREATE USER 'UCDu'@'localhost' IDENTIFIED BY 'root';GRANT ALL ON UCD.* TO 'UCDu'@'localhost' WITH GRANT OPTION;" | mysql -uroot -proot

RUN apt-get install -y unzip 
RUN unzip URBANCODE_DEPLOY_6.2.2_EN_EVAL.zip
WORKDIR ibm-ucd-install
RUN cp /usr/share/java/mysql-connector-java-5.1.38.jar /lib/ext
RUN echo "nonInteractive=true" >> install.properties
RUN echo "" >> install.properties
RUN echo "database.type=mysql" >> install.properties

ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java

RUN cat install.extra.properties >> install.properties && \
    sed -i '/chmod +x "opt\/apache-ant-\${OUR_ANT_VERSION}\/bin\/ant"/ s/$/; sync/' install-server.sh && \
    chmod +x install-server.sh; sync && \
    ./install-server.sh

#ENTRYPOINT  /opt/nexus-3.0.2-02/bin/nexus start && bash
